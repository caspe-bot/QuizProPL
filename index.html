<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>QuizProX ‚Äî Sprawd≈∫ wiedzƒô o Polsce</title>
<style>
:root{
  --bg1:#071025;
  --card:#0b1220;
  --text:#e6f7ff;
  --muted:#9fb6d6;
  --neon1:#00f0ff;
  --neon2:#ff3fc4;
  --good:#16d36a;
  --bad:#ff5c6c;
  --accent:#ffd27a;
  --radius:14px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Roboto,Arial}
body{
  background:linear-gradient(180deg,var(--bg1),#051028 80%);
  color:var(--text);
  display:flex;align-items:center;justify-content:center;padding:20px;
}
.page{width:100%;max-width:920px}
.ad-top,.ad-bottom{
  background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px dashed rgba(255,255,255,0.04);
  color:var(--muted); border-radius:12px; padding:10px; text-align:center; margin-bottom:12px;
  font-size:0.95rem;
}
.card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:var(--radius);
  padding:22px;
  box-shadow:0 10px 40px rgba(0,0,0,0.6);
  border:1px solid rgba(0,255,255,0.04);
}
.top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
.title{font-weight:800;color:var(--neon1);letter-spacing:0.6px}
.score{font-weight:700;color:var(--accent)}
.question{font-size:1.4rem;text-align:center;margin:8px 0 14px;color:var(--text)}
.answers{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:700px){ .answers{grid-template-columns:1fr} .question{font-size:1.08rem} }

.btn{
  display:flex;align-items:center;justify-content:center;padding:12px;border-radius:12px;cursor:pointer;
  user-select:none;font-weight:800;color:white;font-size:0.98rem;min-height:52px;
  transition:transform .12s ease, box-shadow .12s ease, opacity .12s;
  background:linear-gradient(90deg,var(--neon1),var(--neon2));
  box-shadow:0 10px 40px rgba(0,240,255,0.04), 0 0 20px rgba(255,63,196,0.02);
  border:1px solid rgba(255,255,255,0.02);
}
.btn:active{transform:translateY(2px)}
.btn:hover{transform:translateY(-4px); box-shadow:0 18px 60px rgba(0,240,255,0.06);}
.btn.good{ background: linear-gradient(90deg,var(--good),#8df3b0); box-shadow:0 10px 40px rgba(22,211,106,0.06);}
.btn.bad{ background: linear-gradient(90deg,var(--bad),#ff8a94); box-shadow:0 10px 40px rgba(255,92,108,0.06);}

.meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:var(--muted);font-size:0.95rem}
.ranking{margin-top:12px;color:var(--muted);max-height:200px;overflow-y:auto;padding:6px}
.ranking ol{padding-left:18px;margin:6px 0}

/* final overlay */
#final{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(3,6,10,0.85),rgba(2,3,8,0.9));z-index:1200}
#final-card{background:linear-gradient(180deg,#081322,#06121f);padding:20px;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,0.7);text-align:center;color:var(--text);max-width:580px;width:94%}
.final-actions{display:flex;flex-direction:column;gap:10px;align-items:stretch;margin-top:10px}
.final-actions .btn{font-size:1rem;padding:12px 14px}
.save-btn{background:linear-gradient(90deg,#ffd27a,#ff9f43); color:#081322; font-weight:800; box-shadow:0 10px 36px rgba(255,157,66,0.06)}
.small-muted{color:var(--muted);font-size:0.95rem;margin-top:8px}

/* messages */
.msg{
  position:fixed; right:16px; bottom:16px; z-index:1300;
  background:rgba(0,0,0,0.7); padding:10px 14px; border-radius:10px; color:#fff; font-size:0.95rem;
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
  display:none;
}

/* canvas */
canvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:1100}
</style>
</head>
<body>
<canvas id="fx"></canvas>

<div class="page">
  <div class="ad-top">Miejsce na reklamƒô ‚Äî g√≥rny baner</div>

  <div class="card" id="quizCard">
    <div class="top">
      <div class="title">QuizProX ‚Äî Sprawd≈∫ wiedzƒô o Polsce</div>
      <div class="score">Punkty: <span id="points">0</span></div>
    </div>

    <div id="question" class="question">≈Åadowanie...</div>
    <div id="answers" class="answers"></div>

    <div class="meta">
      <div id="progress">Pytanie 0/0</div>
      <div class="small-muted">Miejsca reklamowe gotowe</div>
    </div>

    <div id="ranking" class="ranking" aria-hidden="true"></div>
  </div>

  <div style="height:12px"></div>
  <div class="ad-bottom">Miejsce na reklamƒô ‚Äî dolny baner</div>
</div>

<!-- final modal / overlay -->
<div id="final" aria-hidden="true">
  <div id="final-card">
    <h1 style="margin:6px 0 8px; color:var(--neon2)">Tw√≥j wynik</h1>
    <div id="final-text" class="small-muted">0 pkt</div>

    <div class="final-actions" style="margin-top:14px;">
      <div class="btn big" id="retryBtn" style="background:linear-gradient(90deg,#16d36a,#8df3b0)">Popraw wynik</div>
      <div class="btn big" id="shareBtn" style="background:linear-gradient(90deg,#00f0ff,#ff3fc4)">Poleƒá quiz</div>
      <div class="btn save-btn" id="saveBtn" title="Dodaj do ekranu g≈Ç√≥wnego">üì≤ Zapisz na ekranie g≈Ç√≥wnym</div>
      <div class="btn big" id="endBtn" style="background:linear-gradient(90deg,#ff5c6c,#ff8a94)">Koniec</div>
    </div>

    <div id="final-ranking" class="ranking"></div>
    <div class="small-muted" style="margin-top:8px">Dziƒôkujemy za grƒô ‚Äî wr√≥ƒá jutro i pobij sw√≥j wynik!</div>
  </div>
</div>

<div class="msg" id="msgBox"></div>

<!-- sounds -->
<audio id="bg" loop src="sounds/background.mp3"></audio>
<audio id="snd-ding" src="sounds/ding.mp3"></audio>
<audio id="snd-buzzer" src="sounds/buzzer.mp3"></audio>
<audio id="snd-fanfare" src="sounds/fanfare.mp3"></audio>

<script>
(() => {
  /* ====== QUESTIONS: 150 items (polskie, mieszane, ≈õrednie) ====== */
  const QUESTIONS = [
    { q: "Stolica Polski?", a: ["Warszawa","Krak√≥w","Gda≈Ñsk","Wroc≈Çaw"], correct: 0 },
    { q: "Najd≈Çu≈ºsza rzeka w Polsce?", a: ["Wis≈Ça","Odra","Warta","Bug"], correct: 0 },
    { q: "Najwy≈ºszy szczyt w Polsce?", a: ["Rysy","≈önie≈ºka","Giewont","Babia G√≥ra"], correct: 0 },
    { q: "W kt√≥rym roku Polska odzyska≈Ça niepodleg≈Ço≈õƒá (XX wiek)?", a: ["1918","1945","1914","1939"], correct: 0 },
    { q: "Jak brzmi herb Polski?", a: ["Orze≈Ç bia≈Çy w koronie","Lew czerwony","Pogo≈Ñ","DƒÖb"], correct: 0 },
    { q: "Kt√≥re miasto jest siedzibƒÖ Wawelu?", a: ["Krak√≥w","Warszawa","Pozna≈Ñ","Szczecin"], correct: 0 },
    { q: "Gdzie znajduje siƒô kopalnia soli wpisana na listƒô UNESCO?", a: ["Wieliczka","Kopalnia Soli K≈Çodawa","Bochnia","Inowroc≈Çaw"], correct: 0 },
    { q: "Kto napisa≈Ç 'Pan Tadeusz'?", a: ["Adam Mickiewicz","Juliusz S≈Çowacki","Henryk Sienkiewicz","Boles≈Çaw Prus"], correct: 0 },
    { q: "Najwiƒôksze jezioro w Polsce to:", a: ["≈öniardwy","Mamry","Niegocin","Ha≈Ñcza"], correct: 0 },
    { q: "Kt√≥re miasto bywa nazywane 'Miastem Stu Most√≥w'?", a: ["Wroc≈Çaw","Gda≈Ñsk","≈Å√≥d≈∫","Sopot"], correct: 0 },

    { q: "Gdzie znajduje siƒô P√≥≈Çwysep Helski?", a: ["Nad Ba≈Çtykiem","Nad OdrƒÖ","Nad Wis≈ÇƒÖ","Nad WartƒÖ"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjne danie z kapusty i miƒôsa?", a: ["Bigos","≈ªurek","Flaki","Kapu≈õniak"], correct: 0 },
    { q: "W kt√≥rym roku Polska wstƒÖpi≈Ça do Unii Europejskiej?", a: ["2004","1999","2007","2001"], correct: 0 },
    { q: "Kto by≈Ç pierwszym kr√≥lem koronowanym Polski?", a: ["Boles≈Çaw I Chrobry","Mieszko I","Kazimierz Wielki","W≈Çadys≈Çaw Jagie≈Ç≈Ço"], correct: 0 },
    { q: "Gdzie odbywa siƒô coroczny festiwal Pol'and'Rock (dawniej Woodstock)?", a: ["Kostrzyn nad OdrƒÖ","Warszawa","Gda≈Ñsk","Krak√≥w"], correct: 0 },
    { q: "Kt√≥re miasto jest stolicƒÖ wojew√≥dztwa pomorskiego?", a: ["Gda≈Ñsk","Gdynia","Sopot","ElblƒÖg"], correct: 0 },
    { q: "Kt√≥ry polski re≈ºyser stworzy≈Ç 'Cz≈Çowieka z marmuru'?", a: ["Andrzej Wajda","Roman Pola≈Ñski","Krzysztof Kie≈õlowski","Agnieszka Holland"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjny polski chleb ≈ºytni z zakwasem?", a: ["Chleb ≈ºytni","Bu≈Çka","Bia≈Çy chleb","Kajzerka"], correct: 0 },
    { q: "Kto napisa≈Ç 'Lalkƒô'?", a: ["Boles≈Çaw Prus","Henryk Sienkiewicz","Maria Konopnicka","Stefan ≈ªeromski"], correct: 0 },
    { q: "Jaki instrument by≈Ç zwiƒÖzany z Fryderykiem Chopinem?", a: ["Fortepian","Skrzypce","Akordeon","Gitara"], correct: 0 },

    { q: "Jak nazywa siƒô najwiƒôkszy polski port nad Ba≈Çtykiem?", a: ["Gda≈Ñsk","Szczecin","Gdynia","Ko≈Çobrzeg"], correct: 0 },
    { q: "Kt√≥ry polski sportowiec zdoby≈Ç z≈Çoto w skokach narciarskich na IO?", a: ["Kamil Stoch","Adam Ma≈Çysz","Piotr ≈ªy≈Ça","Dawid Kubacki"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjne ≈õniadanie wielkanocne w Polsce zawierajƒÖce ≈ºurek i bia≈ÇƒÖ kie≈Çbasƒô?", a: ["≈öniadanie wielkanocne","Wigilia","≈öniadanie bo≈ºonarodzeniowe","Poniedzia≈Çek"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z produkcji Obwarzank√≥w i Wawelu?", a: ["Krak√≥w","Warszawa","Pozna≈Ñ","Rzesz√≥w"], correct: 0 },
    { q: "Kt√≥ry z polskich pisarzy otrzyma≈Ç LiterackƒÖ Nagrodƒô Nobla?", a: ["Czes≈Çaw Mi≈Çosz","Boles≈Çaw Prus","Henryk Sienkiewicz","Maria Konopnicka"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjny polski taniec narodowy?", a: ["Polonez","Mazur","Krakowiak","Oberek"], correct: 0 },
    { q: "Gdzie le≈ºy Zamek Kr√≥lewski w Warszawie?", a: ["Stare Miasto","Wawel","≈Åazienki","Nowy ≈öwiat"], correct: 0 },
    { q: "Kt√≥re wojew√≥dztwo ma stolicƒô w Poznaniu?", a: ["Wielkopolskie","Ma≈Çopolskie","Mazowieckie","≈ölƒÖskie"], correct: 0 },
    { q: "Jak nazywa siƒô polska waluta?", a: ["Z≈Çoty","Euro","Dolar","Funt"], correct: 0 },
    { q: "Kt√≥ry poeta jest autorem 'Dziad√≥w' i 'Reduty Ordona'?", a: ["Adam Mickiewicz","Juliusz S≈Çowacki","Cyprian K. Norwid","Zygmunt Krasi≈Ñski"], correct: 0 },

    { q: "Jak nazywa siƒô polski park narodowy z jaskiniami i osta≈Ñcami skalnymi (Jura Krakowsko-Czƒôstochowska)?", a: ["Ojcowski Park Narodowy","Tatrza≈Ñski Park Narodowy","Biebrza≈Ñski Park Narodowy","Kampinoski Park Narodowy"], correct: 0 },
    { q: "Gdzie odbywa siƒô coroczny Festiwal Filmowy w Gdyni?", a: ["Gdynia","Krak√≥w","Warszawa","≈Å√≥d≈∫"], correct: 0 },
    { q: "Kt√≥ry kompozytor jest autorem 'Halki'?", a: ["Stanis≈Çaw Moniuszko","Fryderyk Chopin","Karol Szymanowski","Henryk Wieniawski"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z kozio≈Çk√≥w na ratuszu?", a: ["Pozna≈Ñ","Krak√≥w","Wroc≈Çaw","Gda≈Ñsk"], correct: 0 },
    { q: "W kt√≥rym roku wybuch≈Ço Powstanie Warszawskie?", a: ["1944","1830","1863","1918"], correct: 0 },
    { q: "Jakie miasto jest stolicƒÖ wojew√≥dztwa ≈õlƒÖskiego?", a: ["Katowice","Gliwice","Bytom","Czƒôstochowa"], correct: 0 },
    { q: "Kt√≥re zwierzƒô jest symbolem Puszczy Bia≈Çowieskiej?", a: ["≈ªubr","Wilk","≈Åo≈õ","Ry≈õ"], correct: 0 },
    { q: "Jak nazywa siƒô najwy≈ºsze pasmo g√≥rskie w Polsce?", a: ["Tatry","Karkonosze","Bieszczady","Sudety"], correct: 0 },
    { q: "Kto by≈Ç pierwszym prezydentem III RP (wybranym po 1989)?", a: ["Lech Wa≈Çƒôsa","Wojciech Jaruzelski","Aleksander Kwa≈õniewski","Ignacy Mo≈õcicki"], correct: 0 },
    { q: "Jakie miasto s≈Çynie z krakowskich obwarzank√≥w i Wawelu?", a: ["Krak√≥w","Warszawa","Pozna≈Ñ","Lublin"], correct: 0 },

    { q: "Kt√≥re jezioro le≈ºy na Pojezierzu Mazurskim i jest najwiƒôksze?", a: ["≈öniardwy","Niegocin","Mamry","Ha≈Ñcza"], correct: 0 },
    { q: "Kt√≥ry malarz namalowa≈Ç 'Bitwƒô pod Grunwaldem'?", a: ["Jan Matejko","Jacek Malczewski","J√≥zef Che≈Çmo≈Ñski","Stanis≈Çaw Wyspia≈Ñski"], correct: 0 },
    { q: "Jak nazywa siƒô polska opera narodowa w Warszawie?", a: ["Teatr Wielki ‚Äì Opera Narodowa","Opera Krakowska","Opera ≈ölƒÖska","Opera Nova"], correct: 0 },
    { q: "Jakie tradycyjne potrawy znajdujƒÖ siƒô na wielkanocnym stole w Polsce?", a: ["≈ªurek i bia≈Ça kie≈Çbasa","Bigos i pierogi","Ros√≥≈Ç i kotlet","Zupa pomidorowa i kopytka"], correct: 0 },
    { q: "W kt√≥rym mie≈õcie znajduje siƒô Zamek Kr√≥lewski na Wawelu?", a: ["Krak√≥w","Warszawa","Gda≈Ñsk","Pozna≈Ñ"], correct: 0 },
    { q: "Jak nazywa siƒô polski taniec narodowy, tradycyjny taniec par?", a: ["Polonez","Oberek","Kujawiak","Mazur"], correct: 0 },
    { q: "Kt√≥ry polski poeta wygra≈Ç Nagrodƒô Nobla w literaturze?", a: ["Czes≈Çaw Mi≈Çosz","Adam Mickiewicz","Boles≈Çaw Le≈õmian","Juliusz S≈Çowacki"], correct: 0 },
    { q: "Jak nazywa siƒô najwiƒôksze lotnisko w Polsce (miƒôdzynarodowe)?", a: ["Warszawa Chopin","Krak√≥w Balice","Gda≈Ñsk Rƒôbiechowo","Katowice Pyrzowice"], correct: 0 },
    { q: "Kt√≥ry polski narciarz zdoby≈Ç popularno≈õƒá na poczƒÖtku XXI wieku (skoczek)?", a: ["Adam Ma≈Çysz","Kamil Stoch","Piotr ≈ªy≈Ça","Dawid Kubacki"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjne polskie ≈õwiƒôto obchodzone 3 maja?", a: ["≈öwiƒôto Konstytucji 3 Maja","Bo≈ºe Cia≈Ço","≈öwiƒôto Niepodleg≈Ço≈õci","≈öwiƒôto Pracy"], correct: 0 },

    { q: "Kt√≥re miasto jest znane z Manufaktury i przemys≈Çu w≈Ç√≥kienniczego (du≈ºe centrum handlowe i kulturalne)?", a: ["≈Å√≥d≈∫","Wroc≈Çaw","Pozna≈Ñ","Szczecin"], correct: 0 },
    { q: "Gdzie stoi Pomnik Bohater√≥w Warszawy (Warszawa ‚Äî Syrena)?", a: ["Warszawa ‚Äî Syrena/Stare Miasto","Krak√≥w ‚Äî Wawel","Gda≈Ñsk ‚Äî D≈Çugi Targ","Pozna≈Ñ ‚Äî Stary Rynek"], correct: 0 },
    { q: "Kt√≥ry polski astronom ≈ºy≈Ç przed wiekami i zmieni≈Ç poglƒÖdy o wszech≈õwiecie?", a: ["Miko≈Çaj Kopernik","Jan Heweliusz","Karol Olszewski","Nicolaus Copernicus"], correct: 0 },
    { q: "Jak nazywa siƒô s≈Çynny polski fizyk i chemik (dwukrotny noblista)?", a: ["Maria Sk≈Çodowska-Curie","Ignacy ≈Åukasiewicz","Miko≈Çaj Kopernik","Jan Czochralski"], correct: 0 },
    { q: "Kt√≥re miasto nad Ba≈Çtykiem ma charakterystycznƒÖ stoczniƒô i Mot≈Çawƒô?", a: ["Gda≈Ñsk","Sopot","Gdynia","Ko≈Çobrzeg"], correct: 0 },
    { q: "Co to jest 'Bia≈Çowie≈ºa' s≈Çynie z:", a: ["Puszczy i ≈ºubr√≥w","G√≥r i jezior","Pustyni i step√≥w","Wybrze≈ºa"], correct: 0 },
    { q: "W kt√≥rym regionie Polski le≈ºƒÖ Mazury?", a: ["Warmia i Mazury","Podkarpacie","Pomorze","≈ölƒÖsk"], correct: 0 },
    { q: "Jak nazywa siƒô polski miesiƒôcznik literacki lub czasopismo (klasyk)?", a: ["Przekr√≥j","Polityka","Wprost","Newsweek Polska"], correct: 0 },
    { q: "Jakiego koloru jest flaga Polski?", a: ["Bia≈Ço-czerwona","Czerwono-bia≈Ça","Bia≈Ço-niebieska","Zielono-bia≈Ça"], correct: 0 },
    { q: "Kt√≥re miasto jest stolicƒÖ wojew√≥dztwa ≈Ç√≥dzkiego?", a: ["≈Å√≥d≈∫","Piotrk√≥w Trybunalski","Sieradz","Tomasz√≥w Mazowiecki"], correct: 0 },

    { q: "Kt√≥re miasto jest znane z rynku z ratuszem i kozio≈Çkami (Pozna≈Ñ)?", a: ["Pozna≈Ñ","Krak√≥w","Warszawa","Gda≈Ñsk"], correct: 0 },
    { q: "Jak nazywa siƒô znany polski poeta i autor 'Sonet√≥w krymskich'?", a: ["Adam Mickiewicz","Juliusz S≈Çowacki","Cyprian Norwid","Maria Konopnicka"], correct: 0 },
    { q: "Kt√≥re miasto jest siedzibƒÖ Uniwersytetu Jagiello≈Ñskiego?", a: ["Krak√≥w","Warszawa","Pozna≈Ñ","Lublin"], correct: 0 },
    { q: "Co to jest 'Bieszczady'?", a: ["Pasmo g√≥rskie w Polsce","Miasto nad morzem","Rzeka","Park narodowy tylko na Litwie"], correct: 0 },
    { q: "Kt√≥ry polski kompozytor by≈Ç zwiƒÖzany z muzykƒÖ fortepianowƒÖ i Romantyzmem?", a: ["Fryderyk Chopin","Stanis≈Çaw Moniuszko","Karol Szymanowski","Witold Lutos≈Çawski"], correct: 0 },
    { q: "Jak nazywa siƒô najwa≈ºniejszy polski dokument konstytucyjny z 1791 roku?", a: ["Konstytucja 3 maja (1791)","Konstytucja RP (1997)","Ustawa zasadnicza 1800","Ustawa 1918"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjny polski placek ziemniaczany?", a: ["Placki ziemniaczane","Nale≈õniki","Kopytka","Pierogi"], correct: 0 },
    { q: "Kt√≥ry polski sport popularny jest zimƒÖ (skoki narciarskie)?", a: ["Skoki narciarskie","Kolarstwo","Pi≈Çka rƒôczna","Pi≈Çka no≈ºna"], correct: 0 },
    { q: "Jak nazywa siƒô najwiƒôkszy polski park narodowy w Tatrach?", a: ["Tatrza≈Ñski Park Narodowy","Babiog√≥rski Park Narodowy","Bieszczadzki Park Narodowy","Pieni≈Ñski Park Narodowy"], correct: 0 },
    { q: "Gdzie znajduje siƒô popularne schronisko 'Morskie Oko'?", a: ["Tatry","Bieszczady","G√≥ry Sto≈Çowe","Sudety"], correct: 0 },

    { q: "Kt√≥re polskie miasto jest znane z festiwalu filmowego Camerimage (kinematografia)?", a: ["Toru≈Ñ","Krak√≥w","Warszawa","Gdynia"], correct: 0 },
    { q: "Kt√≥re miasto ma s≈Çynne 'Z≈Çote Tarasy' i Pa≈Çac Kultury?", a: ["Warszawa","Krak√≥w","Pozna≈Ñ","Wroc≈Çaw"], correct: 0 },
    { q: "Jakie miasto jest stolicƒÖ wojew√≥dztwa ma≈Çopolskiego?", a: ["Krak√≥w","Nowy SƒÖcz","Tarn√≥w","Zakopane"], correct: 0 },
    { q: "Co to jest 'pƒÖczek' w polskiej kuchni?", a: ["S≈Çodkie ciastko sma≈ºone z nadzieniem","Chleb ≈ºytni","Kie≈Çbasa","Zupa"], correct: 0 },
    { q: "Kt√≥ry polski noblista jest poetƒÖ i autorem m.in. 'Traktatu poetyckiego'?", a: ["Czes≈Çaw Mi≈Çosz","Wis≈Çawa Szymborska","S≈Çawomir Mro≈ºek","Olga Tokarczuk"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z zabytkowego rynku i Sukiennic?", a: ["Krak√≥w","Warszawa","Wroc≈Çaw","Pozna≈Ñ"], correct: 0 },
    { q: "Jak nazywa siƒô najpopularniejsza polska potrawa z miƒôsem i kapustƒÖ?", a: ["Bigos","≈ªurek","Ros√≥≈Ç","Kotlet schabowy"], correct: 0 },
    { q: "Kt√≥re miasto le≈ºy nad Mot≈ÇawƒÖ i ma D≈Çugi Targ?", a: ["Gda≈Ñsk","Sopot","Gdynia","Ko≈Çobrzeg"], correct: 0 },
    { q: "Jak nazywa siƒô polska waluta (skr√≥t)?", a: ["PLN","EUR","USD","GBP"], correct: 0 },
    { q: "Jakie morze oblewa polskie wybrze≈ºe?", a: ["Morze Ba≈Çtyckie","Morze P√≥≈Çnocne","Morze ≈ör√≥dziemne","Morze Czarne"], correct: 0 },

    { q: "Kt√≥ra bitwa (1410) by≈Ça jednym z najwiƒôkszych starƒá ≈õredniowiecznej Europy w polskiej historii?", a: ["Bitwa pod Grunwaldem","Bitwa pod Wiedniem","Bitwa pod Rac≈Çawicami","Bitwa pod Lipanami"], correct: 0 },
    { q: "Jakie miasto jest siedzibƒÖ Politechniki Wroc≈Çawskiej i Rynku we Wroc≈Çawiu?", a: ["Wroc≈Çaw","Pozna≈Ñ","Krak√≥w","Gda≈Ñsk"], correct: 0 },
    { q: "Kt√≥ry polski podr√≥≈ºnik by≈Ç znanym odkrywcƒÖ i synem szlacheckim (wieki dawniej)?", a: ["Krzysztof Kolumb by≈Ç Hiszpanem ‚Äî poprawne polskie postaci to np. Pawe≈Ç Edmund Strzelecki (badacz)", "Miko≈Çaj Kopernik","Jan Heweliusz","Pawe≈Ç Edmund Strzelecki"], correct: 3 },
    { q: "Jak nazywa siƒô najwiƒôkszy polski uniwersytet (pod wzglƒôdem nazwy i tradycji)?", a: ["Uniwersytet Jagiello≈Ñski","Uniwersytet Warszawski","Uniwersytet Adama Mickiewicza","Politechnika Warszawska"], correct: 0 },
    { q: "Kt√≥ra wyspa polska ma latarniƒô morskƒÖ i by≈Çe twierdze (na Ba≈Çtyku)?", a: ["Uznam (czƒô≈õciowo polski)","Hel","Wolin","Bornholm"], correct: 2 },
    { q: "Jak nazywa siƒô s≈Çynna polska piosenkarka, autorka wielu przeboj√≥w (np. 'Nie p≈Çacz Ewka')?", a: ["Edyta G√≥rniak","Kora","Maryla Rodowicz","Anna Jantar"], correct: 2 },
    { q: "Gdzie znajduje siƒô Puszcza Bia≈Çowieska?", a: ["Na granicy Polski i Bia≈Çorusi","Na granicy Polski i Litwy","W centralnej Polsce","Na P√≥≈Çwyspie Helskim"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjny polski pier√≥g z miƒôsem?", a: ["Pierogi","Racuchy","Kluski","Nale≈õniki"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z Zamku KsiƒÖ≈º i pobliskich atrakcji turystycznych?", a: ["Wa≈Çbrzych","Krak√≥w","Wroc≈Çaw","Szczecin"], correct: 0 },
    { q: "Jak nazywa siƒô znane polskie jezioro g√≥rskie (w Tatrach)?", a: ["Morskie Oko","≈öniardwy","Ha≈Ñcza","Niegocin"], correct: 0 },

    { q: "Kt√≥re wojew√≥dztwo ma stolicƒô w Lublinie?", a: ["Lubelskie","Podkarpackie","Lubuskie","≈Å√≥dzkie"], correct: 0 },
    { q: "Jak nazywa siƒô polski noblista literacki z 2018 roku?", a: ["Olga Tokarczuk","Wis≈Çawa Szymborska","Czes≈Çaw Mi≈Çosz","Henryk Sienkiewicz"], correct: 0 },
    { q: "Jak nazywa siƒô najwiƒôksze miasto na Warmii i Mazurach?", a: ["Olsztyn","E≈Çk","Gi≈ºycko","MrƒÖgowo"], correct: 0 },
    { q: "Jak nazywa siƒô polski re≈ºyser ≈õwiatowej s≈Çawy zwiƒÖzany z filmami takimi jak 'Rosemary's Baby'?", a: ["Roman Pola≈Ñski","Andrzej Wajda","Krzysztof Kie≈õlowski","Agnieszka Holland"], correct: 0 },
    { q: "Jakie miasto jest znane z Ostr√≥w Tumski i katedry?", a: ["Pozna≈Ñ","Wroc≈Çaw","Krak√≥w","Gda≈Ñsk"], correct: 0 },
    { q: "Kt√≥re polskie miasto jest portem i centrum przemys≈Çu stoczniowego?", a: ["Gda≈Ñsk","Sopot","Gdynia","Ko≈Çobrzeg"], correct: 0 },
    { q: "Jak nazywa siƒô polska potrawa, kt√≥ra bywa nadziewana miƒôsem lub serem i gotowana?", a: ["Pierogi","Kluski ≈õlƒÖskie","Kopytka","Placki"], correct: 0 },
    { q: "Kto by≈Ç autorem 'Quo Vadis' ‚Äî s≈Çynnej powie≈õci historycznej?", a: ["Henryk Sienkiewicz","Boles≈Çaw Prus","Eliza Orzeszkowa","Stefan ≈ªeromski"], correct: 0 },
    { q: "Jak nazywa siƒô polskie ≈õwiƒôto obchodzone 11 listopada?", a: ["Dzie≈Ñ Niepodleg≈Ço≈õci","≈öwiƒôto Pracy","Bo≈ºe Cia≈Ço","Wniebowziƒôcie"], correct: 0 },
    { q: "Kt√≥ry polski kompozytor napisa≈Ç wiele mazurk√≥w i nokturn√≥w?", a: ["Fryderyk Chopin","Karol Szymanowski","Stanis≈Çaw Moniuszko","Witold Lutos≈Çawski"], correct: 0 },

    { q: "Jakie miasto jest stolicƒÖ wojew√≥dztwa podkarpackiego?", a: ["Rzesz√≥w","Przemy≈õl","Krosno","Sanok"], correct: 0 },
    { q: "Kt√≥ry polski sportowiec jest legendƒÖ w skokach narciarskich (wczesne lata 2000)?", a: ["Adam Ma≈Çysz","Kamil Stoch","Tomasz Sikora","Piotr ≈ªy≈Ça"], correct: 0 },
    { q: "Jak nazywa siƒô polska wyspa popularna turystycznie (na Ba≈Çtyku) z wydmami i pla≈ºami)?", a: ["W≈Çadys≈Çawowo","Hel","Uznam","Kashubia"], correct: 2 },
    { q: "Jak nazywa siƒô zabytek w Poznaniu zwiƒÖzany z kozio≈Çkami?", a: ["Ratusz", "Katedra", "Zamek", "Brama"], correct: 0 },
    { q: "Jakie miasto jest stolicƒÖ wojew√≥dztwa podlaskiego?", a: ["Bia≈Çystok","Suwa≈Çki","≈Åom≈ºa","August√≥w"], correct: 0 },
    { q: "Kt√≥ry w≈Çadca z dynastii Jagiellon√≥w by≈Ç znany z unii z LitwƒÖ i bitwy pod Grunwaldem (wsp√≥lnie)?", a: ["W≈Çadys≈Çaw Jagie≈Ç≈Ço","Kazimierz Wielki","Boles≈Çaw Chrobry","Zygmunt Stary"], correct: 0 },
    { q: "Jak nazywa siƒô najd≈Çu≈ºsze jezioro w Polsce (nazwy masyw√≥w wodnych)?", a: ["≈öniardwy","Mamry","Ha≈Ñcza","Niegocin"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z Zamku Kr√≥lewskiego i ≈Åazienek Kr√≥lewskich?", a: ["Warszawa","Krak√≥w","Gda≈Ñsk","Wroc≈Çaw"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjny instrument ludowy z Polski (np. dudy)?", a: ["Dudy","Skrzypce","Flet","TrƒÖbka"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z Wroc≈Çawskiego Rynku i krasnali?", a: ["Wroc≈Çaw","Pozna≈Ñ","Krak√≥w","Gda≈Ñsk"], correct: 0 },

    { q: "Gdzie znajduje siƒô s≈Çynny most Pi≈Çsudskiego i Stare Miasto w Gda≈Ñsku?", a: ["D≈Çugi Targ i Mot≈Çawa","Wawel","Rynek G≈Ç√≥wny","Stary Rynek Pozna≈Ñ"], correct: 0 },
    { q: "Kt√≥ry polski noblista jest autorem wierszy i esei (ur. 1924)?", a: ["Czes≈Çaw Mi≈Çosz","Wis≈Çawa Szymborska","Zbigniew Herbert","Tadeusz R√≥≈ºewicz"], correct: 0 },
    { q: "Jakie jest najwiƒôksze miasto na ≈ölƒÖsku?", a: ["Katowice","Gliwice","Bytom","Rybnik"], correct: 0 },
    { q: "Jak nazywa siƒô polski skoczek narciarski, kt√≥ry wygra≈Ç Turniej Czterech Skoczni?", a: ["Kamil Stoch","Adam Ma≈Çysz","Piotr ≈ªy≈Ça","Dawid Kubacki"], correct: 0 },
    { q: "Gdzie znajduje siƒô s≈Çynna kopalnia soli Bochnia lub Wieliczka (UNESCO)?", a: ["Wieliczka","Bochnia","K≈Çodawa","Inowroc≈Çaw"], correct: 0 },
    { q: "Kt√≥ra polska wyspa s≈Çynie z latarni morskiej (np. Rozewie)?", a: ["P√≥≈Çwysep Helski/Rozewie region","Wolin","Hel","Uznam"], correct: 0 },
    { q: "Jak nazywa siƒô tradycyjna polska zupa z ≈ºuru?", a: ["≈ªurek","Barszcz czerwony","Ros√≥≈Ç","Flaki"], correct: 0 },
    { q: "Kt√≥ry polski malarz jest autorem portret√≥w i monumentalnych obraz√≥w historycznych (np. Matejko)?", a: ["Jan Matejko","Jacek Malczewski","J√≥zef Che≈Çmo≈Ñski","Stanis≈Çaw Wyspia≈Ñski"], correct: 0 },
    { q: "Jak nazywa siƒô polskie ≈õwiƒôto obchodzone 1 maja?", a: ["≈öwiƒôto Pracy","Dzie≈Ñ Niepodleg≈Ço≈õci","Bo≈ºe Cia≈Ço","Wigilia"], correct: 0 },
    { q: "Kt√≥re miasto le≈ºy najbli≈ºej polsko-czeskiej granicy i s≈Çynie z zabytk√≥w (np. K≈Çodzko)?", a: ["K≈Çodzko","Wroc≈Çaw","Opole","Katowice"], correct: 0 },

    { q: "Kt√≥ry polski filozof i my≈õliciel napisa≈Ç wa≈ºne prace (XIX w.)? (np. Ernst Tugendhat ‚Äî niepolski) ‚Äî pytanie og√≥lne o kulturƒô", a: ["J√≥zef Tischner","Leszek Ko≈Çakowski","Roman Ingarden","Tadeusz Kotarbi≈Ñski"], correct: 1 },
    { q: "Jak nazywa siƒô najwa≈ºniejsza polska nagroda filmowa przyznawana w Gdyni?", a: ["Festiwal Polskich Film√≥w Fabularnych (Gdynia)","Camerimage","Off Camera","Transatlantyk"], correct: 0 },
    { q: "JakƒÖ polskƒÖ potrawƒô czƒôsto podaje siƒô z kapustƒÖ i miƒôsem (danie tradycyjne)?", a: ["Bigos","Pierogi","≈ªurek","Ros√≥≈Ç"], correct: 0 },
    { q: "Gdzie znajduje siƒô Kana≈Ç ElblƒÖski (znany z pochylni)?", a: ["Warmia i Mazury / ElblƒÖg region","Pomorze","Mazowsze","Ma≈Çopolska"], correct: 0 },
    { q: "Jak nazywa siƒô polski kompozytor XX wieku znany z muzyki powa≈ºnej?", a: ["Witold Lutos≈Çawski","Henryk Wieniawski","Karol Szymanowski","Gra≈ºyna Bacewicz"], correct: 0 },
    { q: "Kt√≥ry polski malarz tworzy≈Ç w okresie modernizmu (np. Wyspia≈Ñski)?", a: ["Stanis≈Çaw Wyspia≈Ñski","Jan Matejko","Jacek Malczewski","Artur Grottger"], correct: 0 },
    { q: "Jak nazywa siƒô s≈Çynny polski poeta XX wieku, autorka kr√≥tkich form (wierszy) i noblistka?", a: ["Wis≈Çawa Szymborska","Olga Tokarczuk","Czes≈Çaw Mi≈Çosz","Zbigniew Herbert"], correct: 0 },
    { q: "Jakie miasto jest znane z zabytkowego zamku Malbork?", a: ["Malbork","Gda≈Ñsk","ElblƒÖg","S≈Çupsk"], correct: 0 },
    { q: "Kt√≥ry polski astronom mia≈Ç wp≈Çyw na naukƒô (Kopernik)?", a: ["Miko≈Çaj Kopernik","Jan Heweliusz","Nicolaus Copernicus","Obie poprawne"], correct: 3 },
    { q: "Jak nazywa siƒô tradycyjna polska potrawa z ziemniak√≥w i miƒôsa (popularna)?", a: ["Placki ziemniaczane","Kluski ≈õlƒÖskie","Kopytka","Pierogi"], correct: 0 },

    { q: "Jak nazywa siƒô najwiƒôksza wyspa w Polsce (Wolin/Uznam region)?", a: ["Uznam/Wolin region ‚Äî ÔªøWolin (du≈ºe wyspy)", "Bornholm nie jest polski","Hel jest p√≥≈Çwyspem","Sƒôpopol"], correct: 0 },
    { q: "Kt√≥ry polski w≈Çadca by≈Ç znany z budowy wielu zamk√≥w i fortyfikacji (np. Kazimierz Wielki)?", a: ["Kazimierz Wielki","Boles≈Çaw Chrobry","Mieszko I","W≈Çadys≈Çaw Jagie≈Ç≈Ço"], correct: 0 },
    { q: "Gdzie le≈ºƒÖ Bieszczady?", a: ["Na po≈Çudniowym wschodzie Polski","Na p√≥≈Çnocy Polski","Na zachodzie Polski","Na centralnej nizinie"], correct: 0 },
    { q: "Jakie miasto jest stolicƒÖ wojew√≥dztwa ≈õwiƒôtokrzyskiego?", a: ["Kielce","Sandomierz","Ostrowiec ≈öwiƒôtokrzyski","Starachowice"], correct: 0 },
    { q: "Jak nazywa siƒô najwa≈ºniejszy polski dokument konstytucyjny uchwalony w 1997 roku?", a: ["Konstytucja Rzeczypospolitej Polskiej (1997)","Konstytucja 3 maja (1791)","Ustawa zasadnicza 1800","Dekret 1918"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z kopalni soli w Wieliczce?", a: ["Wieliczka","Bochnia","K≈Çodawa","Inowroc≈Çaw"], correct: 0 },
    { q: "Jak nazywa siƒô polska tradycyjna piosenka ludowa?", a: ["Hej≈ºe, hej! (przyk≈Çad)","Sto lat","Mazurka DƒÖbrowskiego","Hymn"], correct: 0 },
    { q: "Kt√≥re miasto jest stolicƒÖ wojew√≥dztwa zachodniopomorskiego?", a: ["Szczecin","Koszalin","≈öwinouj≈õcie","Police"], correct: 0 },
    { q: "Jak nazywa siƒô g√≥rska miejscowo≈õƒá znana z Zakopanego jako centrum Tatr?", a: ["Zakopane","Karpacz","Szklarska Porƒôba","Szczyrk"], correct: 0 },
    { q: "Kt√≥ry polski astronom mia≈Ç obserwatorium w Gda≈Ñsku (Jan Heweliusz)?", a: ["Jan Heweliusz","Miko≈Çaj Kopernik","Nicolaus Copernicus","Obie poprawne"], correct: 0 },

    { q: "Jak nazywa siƒô polski kompozytor XX wieku zwiƒÖzany z modernizmem (Szymanowski)?", a: ["Karol Szymanowski","Fryderyk Chopin","Stanis≈Çaw Moniuszko","Witold Lutos≈Çawski"], correct: 0 },
    { q: "Kt√≥ra z poni≈ºszych potraw jest tradycyjnym polskim daniem ≈õwiƒÖtecznym (Bo≈ºe Narodzenie)?", a: ["Wigilia ‚Äî barszcz z uszkami","Bigos z miƒôsem","≈ªurek","Kotlet schabowy"], correct: 0 },
    { q: "Jakie miasto jest gospodarzem corocznego festiwalu szantowego 'Shanties' (przyk≈Çad)?", a: ["Gdynia","Gda≈Ñsk","Sopot","Szczecin"], correct: 0 },
    { q: "Jak nazywa siƒô najwa≈ºniejsza polska uczelnia medyczna (np. Akademia Medyczna w Warszawie)?", a: ["Uniwersytet Medyczny w Warszawie","Uniwersytet Medyczny w ≈Åodzi","AM Krak√≥w","AM Pozna≈Ñ"], correct: 0 },
    { q: "Kt√≥re miasto jest znane z Bramy Floria≈Ñskiej i Sukiennic?", a: ["Krak√≥w","Warszawa","Gda≈Ñsk","Wroc≈Çaw"], correct: 0 },
    { q: "Jak nazywa siƒô s≈Çynna polska piosenkarka z piosenkami lat 80. i 90. (np. Edyta G√≥rniak)?", a: ["Edyta G√≥rniak","Maryla Rodowicz","Kora","Anna Jantar"], correct: 0 },
    { q: "Kt√≥re miasto jest stolicƒÖ wojew√≥dztwa lubuskiego?", a: ["Zielona G√≥ra","Gorz√≥w Wielkopolski","S≈Çubice","Miƒôdzyrzecz"], correct: 0 },
    { q: "Jak nazywa siƒô najwiƒôkszy polski zamek ceglany (Malbork)?", a: ["Zamek w Malborku","Zamek KsiƒÖ≈º","Zamek w Wawelu","Zamek w Gniewie"], correct: 0 },
    { q: "Jakie morze oblewa polskie wybrze≈ºe?", a: ["Morze Ba≈Çtyckie","Morze Czarne","Morze ≈ör√≥dziemne","Morze P√≥≈Çnocne"], correct: 0 },
    { q: "Kt√≥ry polski w≈Çadca sta≈Ç siƒô znany jako 'Chrobry'?", a: ["Boles≈Çaw I Chrobry","Mieszko I","Kazimierz Wielki","W≈Çadys≈Çaw Jagie≈Ç≈Ço"], correct: 0 }
  ];

  /* ====== DOM & STATE ====== */
  const $ = id => document.getElementById(id);
  const questionEl = $('question'), answersEl = $('answers'), pointsEl = $('points'),
        progressEl = $('progress'), rankingEl = $('ranking'), finalRankingEl = $('final-ranking'),
        finalOverlay = $('final'), finalText = $('final-text'),
        retryBtn = $('retryBtn'), shareBtn = $('shareBtn'), saveBtn = $('saveBtn'), endBtn = $('endBtn'),
        bg = $('bg'), sndDing = $('snd-ding'), sndBuzzer = $('snd-buzzer'), sndFanfare = $('snd-fanfare'),
        msgBox = $('msgBox'), canvas = $('fx'), ctx = canvas.getContext('2d');

  function resize(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  window.addEventListener('resize', resize); resize();

  let pool = [], order = [], cur = 0, points = 0;
  let musicStarted = false; let fanfarePlayed = false;
  const STORAGE_KEY = 'quizprox_150_scores_v1';
  let deferredPrompt = null;
  window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });

  function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }
  function showMsg(text, timeout=2200){ msgBox.textContent = text; msgBox.style.display = 'block'; setTimeout(()=>{ msgBox.style.display = 'none'; }, timeout); }
  function startMusic(){ if(!musicStarted){ musicStarted = true; bg.volume = 0.55; bg.play().catch(()=>{}); } }

  /* ====== Flow ====== */
  function startRound(){
    pool = shuffle(QUESTIONS.map((_,i)=>i));
    order = pool.slice(0, Math.min(10, pool.length));
    cur = 0; points = 0; pointsEl.textContent = points; fanfarePlayed = false;
    progressEl.textContent = `Pytanie ${cur+1}/${order.length}`; rankingEl.setAttribute('aria-hidden','true');
    renderQuestion();
  }

  function renderQuestion(){
    const idx = order[cur]; const q = QUESTIONS[idx];
    progressEl.textContent = `Pytanie ${cur+1}/${order.length}`;
    questionEl.textContent = q.q; answersEl.innerHTML = '';
    const mapped = q.a.map((t,i)=>({t,i})); const shuffled = shuffle(mapped);
    shuffled.forEach(item=>{
      const btn = document.createElement('div'); btn.className = 'btn'; btn.textContent = item.t;
      btn.onclick = () => { startMusic(); handleAnswer(btn, item.i); }; answersEl.appendChild(btn);
    });
  }

  function handleAnswer(button, chosenIndex){
    Array.from(answersEl.children).forEach(b=>b.onclick=null);
    const idx = order[cur]; const q = QUESTIONS[idx];
    Array.from(answersEl.children).forEach(ch=>{
      if(ch.textContent === q.a[q.correct]){ ch.classList.add('good'); ch.style.background = 'linear-gradient(90deg,#16d36a,#8df3b0)'; }
    });
    if(chosenIndex === q.correct){
      points += 10; pointsEl.textContent = points; try{ sndDing.currentTime=0; sndDing.play(); }catch(e){} spawnConfettiAt(button,14);
    } else {
      button.classList.add('bad'); button.style.background='linear-gradient(90deg,#ff5c6c,#ff8a94)'; try{ sndBuzzer.currentTime=0; sndBuzzer.play(); }catch(e){}
    }
    setTimeout(()=>{ cur++; if(cur<order.length) renderQuestion(); else finishRound(); }, 750);
  }

  function saveScore(s){
    try{
      const raw = localStorage.getItem(STORAGE_KEY); const arr = raw ? JSON.parse(raw) : [];
      arr.push({score:s, date:Date.now()}); arr.sort((a,b)=>b.score-a.score); localStorage.setItem(STORAGE_KEY, JSON.stringify(arr.slice(0,50)));
    }catch(e){}
  }

  function showFinalRanking(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY); const arr = raw ? JSON.parse(raw) : [];
      if(!arr.length){ finalRankingEl.innerHTML = '<div class="small-muted">Brak wynik√≥w ‚Äî zagraj teraz!</div>'; return; }
      finalRankingEl.innerHTML = '<h4>Ranking lokalny</h4><div style="max-height:180px;overflow-y:auto;"><ol>'+arr.slice(0,50).map(x=>`<li style="margin:6px 0; padding:6px; border-radius:8px; background:rgba(0,255,230,0.03)"><strong>${x.score}</strong> pkt</li>`).join('')+'</ol></div>';
    }catch(e){ finalRankingEl.innerHTML=''; }
  }

  function finishRound(){
    saveScore(points);
    if(!fanfarePlayed){ fanfarePlayed = true; try{ sndFanfare.currentTime=0; sndFanfare.play(); }catch(e){} }
    triggerFinalFireworks();
    setTimeout(()=>{
      finalText.textContent = `${points} pkt`;
      document.getElementById('quizCard').style.display = 'none';
      finalOverlay.style.display = 'flex';
      fadeOutMusic();
      showFinalRanking();
    }, 850);
  }

  retryBtn.addEventListener('click', ()=>{
    finalOverlay.style.display = 'none'; document.getElementById('quizCard').style.display = 'block';
    fanfarePlayed = false; startRound();
  });

  shareBtn.addEventListener('click', ()=>{
    if(navigator.share){ navigator.share({ title:'QuizProX ‚Äî Sprawd≈∫ wiedzƒô!', text:'Zagraj w QuizProX ‚Äî sprawd≈∫ swojƒÖ wiedzƒô o Polsce!', url: location.href }).catch(()=>{}); }
    else { copyToClipboard(location.href); showMsg('Link skopiowany ‚Äî wy≈õlij znajomym!'); }
  });

  endBtn.addEventListener('click', ()=>{ stopAndShowEnd(); });

  function stopAndShowEnd(){
    try{ bg.pause(); }catch(e){} try{ sndDing.pause(); sndBuzzer.pause(); sndFanfare.pause(); }catch(e){}
    document.getElementById('quizCard').style.display = 'none'; finalOverlay.style.display = 'flex';
    finalText.textContent = 'Dziƒôkujemy za grƒô! Do zobaczenia jutro üëã'; finalRankingEl.innerHTML = '';
    retryBtn.style.display = 'none'; shareBtn.style.display = 'none'; saveBtn.style.display = 'none'; endBtn.style.display = 'none';
  }

  /* Save to home screen */
  saveBtn.addEventListener('click', async ()=>{
    if(deferredPrompt){ deferredPrompt.prompt(); const choice = await deferredPrompt.userChoice.catch(()=>null); deferredPrompt = null;
      if(choice && choice.outcome === 'accepted') showMsg('Dodano do ekranu g≈Ç√≥wnego!'); else showMsg('Akcja anulowana.'); return;
    }
    copyToClipboard(location.href); showMsg('Link skopiowany. Na telefonie: Udostƒôpnij ‚Üí Dodaj do ekranu g≈Ç√≥wnego.');
    setTimeout(()=>{ alert('Aby dodaƒá do ekranu g≈Ç√≥wnego:\n\n‚Ä¢ Android (Chrome): menu (‚ãÆ) ‚Üí Dodaj do ekranu g≈Ç√≥wnego\n‚Ä¢ iPhone (Safari): Udostƒôpnij ‚Üí Dodaj do ekranu g≈Ç√≥wnego'); }, 350);
  });

  function copyToClipboard(text){ if(navigator.clipboard && window.isSecureContext){ navigator.clipboard.writeText(text).catch(()=>{ fallbackCopy(text); }); } else fallbackCopy(text); }
  function fallbackCopy(text){ const ta = document.createElement('textarea'); ta.value = text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); }catch(e){} document.body.removeChild(ta); }

  function fadeOutMusic(){ if(!bg) return; let vol = bg.volume || 0.55; const iv = setInterval(()=>{ vol -= 0.06; if(vol <= 0.05){ try{ bg.pause(); }catch(e){} bg.volume = 0.55; clearInterval(iv); } else bg.volume = Math.max(0, vol); }, 120); }

  /* Confetti (lightweight) */
  const particles = []; let running = false;
  function spawnConfettiAt(el, count=14){
    const r = el.getBoundingClientRect(); const x = r.left + r.width/2; const y = r.top + r.height/2;
    spawn(x,y, Math.max(8, Math.min(18, count)), { spread: Math.PI*1.4, speed:3.0, gravity:0.12, life:60 });
  }
  function spawn(x,y,amount,opts={}){ const cols = ['#00f0ff','#ff3fc4','#ffd75e','#5bff93','#b58bff','#ff9f43']; const spread = opts.spread || Math.PI*2; const speed = opts.speed || 3; const gravity = opts.gravity || 0.08; const life = opts.life || 80; for(let i=0;i<amount;i++){ const angle = (Math.random()-0.5)*spread; const spd = (0.8 + Math.random()*0.9) * speed; particles.push({ x: x + (Math.random()-0.5)*6, y: y + (Math.random()-0.5)*6, vx: Math.cos(angle)*spd, vy: Math.sin(angle)*spd - 2.2, age: 0, life: life*(0.6 + Math.random()*0.6), col: cols[Math.floor(Math.random()*cols.length)], size: 1.4 + Math.random()*2.2, gravity, friction: 0.995 }); } if(!running) runLoop(); }
  function runLoop(){ running = true; function step(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(let i=particles.length-1;i>=0;i--){ const p = particles[i]; p.age++; p.vy += p.gravity; p.vx *= p.friction; p.vy *= p.friction; p.x += p.vx; p.y += p.vy; const lr = 1 - p.age / p.life; if(lr <= 0 || p.y > canvas.height + 30){ particles.splice(i,1); continue; } ctx.save(); ctx.globalAlpha = Math.max(0.02, lr*0.95); ctx.fillStyle = p.col; ctx.filter = 'blur(1px)'; ctx.beginPath(); ctx.arc(p.x, p.y, p.size*1.3, 0, Math.PI*2); ctx.fill(); ctx.restore(); ctx.beginPath(); ctx.globalAlpha = Math.min(1, lr + 0.1); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); } if(particles.length > 0) requestAnimationFrame(step); else running = false; } requestAnimationFrame(step); }

  function triggerFinalFireworks(){ const W = canvas.width, H = canvas.height; for(let i=0;i<4;i++){ const cx = Math.random()*(W*0.8)+W*0.1; const cy = Math.random()*(H*0.35)+40; spawn(cx, cy, 40, { spread: Math.PI*2, speed:4.0, gravity:0.04, life:110 }); } }

  /* init */
  function init(){ resize(); startRound(); function startOnFirstClick(){ startMusic(); document.removeEventListener('click', startOnFirstClick); } document.addEventListener('click', startOnFirstClick); }
  window.addEventListener('load', init);

  // expose for debug
  window.QuizProX = { startRound };

})();
</script>
</body>
</html>
